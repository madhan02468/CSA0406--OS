#include <stdio.h>
#include <pthread.h>

pthread_mutex_t f[5];

void* p(void* a){
    int i=(int)a;
    pthread_mutex_lock(&f[i]);
    pthread_mutex_lock(&f[(i+1)%5]);
    printf("P%d eating\n",i);
    pthread_mutex_unlock(&f[i]);
    pthread_mutex_unlock(&f[(i+1)%5]);
    return NULL;
}

int main(){
    pthread_t t[5];
    int i,id[5];
    for(i=0;i<5;i++) pthread_mutex_init(&f[i],0);
    for(i=0;i<5;i++) id[i]=i,pthread_create(&t[i],0,p,&id[i]);
    for(i=0;i<5;i++) pthread_join(t[i],0);
    return 0;
}
